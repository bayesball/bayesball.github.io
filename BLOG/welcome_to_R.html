<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jim Albert">
<meta name="dcterms.date" content="2023-02-06">

<title>Welcome to R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="welcome_to_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="welcome_to_R_files/libs/quarto-html/quarto.js"></script>
<script src="welcome_to_R_files/libs/quarto-html/popper.min.js"></script>
<script src="welcome_to_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="welcome_to_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="welcome_to_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="welcome_to_R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="welcome_to_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="welcome_to_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="welcome_to_R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-r" id="toc-learning-r" class="nav-link" data-scroll-target="#learning-r"><span class="toc-section-number">1.1</span>  Learning R</a></li>
  <li><a href="#i-am-not-using-tidyverse" id="toc-i-am-not-using-tidyverse" class="nav-link" data-scroll-target="#i-am-not-using-tidyverse"><span class="toc-section-number">1.2</span>  I am not using tidyverse</a></li>
  <li><a href="#my-approach-in-welcome-to-r" id="toc-my-approach-in-welcome-to-r" class="nav-link" data-scroll-target="#my-approach-in-welcome-to-r"><span class="toc-section-number">1.3</span>  My Approach in Welcome to R</a></li>
  <li><a href="#some-other-comments" id="toc-some-other-comments" class="nav-link" data-scroll-target="#some-other-comments"><span class="toc-section-number">1.4</span>  Some other comments:</a></li>
  <li><a href="#the-goal" id="toc-the-goal" class="nav-link" data-scroll-target="#the-goal"><span class="toc-section-number">1.5</span>  The Goal</a></li>
  </ul></li>
  <li><a href="#part-i---working-with-vectors" id="toc-part-i---working-with-vectors" class="nav-link" data-scroll-target="#part-i---working-with-vectors"><span class="toc-section-number">2</span>  Part I - Working with Vectors</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="toc-section-number">2.1</span>  Introduction</a></li>
  <li><a href="#getting-started-with-r-and-rstudio" id="toc-getting-started-with-r-and-rstudio" class="nav-link" data-scroll-target="#getting-started-with-r-and-rstudio"><span class="toc-section-number">2.2</span>  Getting Started with R and RStudio</a></li>
  <li><a href="#r-markdown-files" id="toc-r-markdown-files" class="nav-link" data-scroll-target="#r-markdown-files"><span class="toc-section-number">2.3</span>  R Markdown Files</a></li>
  <li><a href="#vectors" id="toc-vectors" class="nav-link" data-scroll-target="#vectors"><span class="toc-section-number">2.4</span>  Vectors</a></li>
  <li><a href="#vector-indices" id="toc-vector-indices" class="nav-link" data-scroll-target="#vector-indices"><span class="toc-section-number">2.5</span>  Vector Indices</a></li>
  <li><a href="#vector-operations" id="toc-vector-operations" class="nav-link" data-scroll-target="#vector-operations"><span class="toc-section-number">2.6</span>  Vector Operations</a></li>
  <li><a href="#graphs-of-vector-data" id="toc-graphs-of-vector-data" class="nav-link" data-scroll-target="#graphs-of-vector-data"><span class="toc-section-number">2.7</span>  Graphs of Vector Data</a></li>
  <li><a href="#summary-and-looking-forward" id="toc-summary-and-looking-forward" class="nav-link" data-scroll-target="#summary-and-looking-forward"><span class="toc-section-number">2.8</span>  Summary and Looking Forward</a></li>
  </ul></li>
  <li><a href="#part-2---importing-data-and-data-frames" id="toc-part-2---importing-data-and-data-frames" class="nav-link" data-scroll-target="#part-2---importing-data-and-data-frames"><span class="toc-section-number">3</span>  Part 2 - Importing Data and Data Frames</a>
  <ul class="collapse">
  <li><a href="#introduction-2" id="toc-introduction-2" class="nav-link" data-scroll-target="#introduction-2"><span class="toc-section-number">3.1</span>  Introduction</a></li>
  <li><a href="#importing-a-fangraphs-dataset-into-r" id="toc-importing-a-fangraphs-dataset-into-r" class="nav-link" data-scroll-target="#importing-a-fangraphs-dataset-into-r"><span class="toc-section-number">3.2</span>  Importing a FanGraphs Dataset into R</a></li>
  <li><a href="#some-data-cleaning" id="toc-some-data-cleaning" class="nav-link" data-scroll-target="#some-data-cleaning"><span class="toc-section-number">3.3</span>  Some Data Cleaning</a></li>
  <li><a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames"><span class="toc-section-number">3.4</span>  Data Frames</a></li>
  <li><a href="#selecting-rows-and-columns" id="toc-selecting-rows-and-columns" class="nav-link" data-scroll-target="#selecting-rows-and-columns"><span class="toc-section-number">3.5</span>  Selecting Rows and Columns</a></li>
  <li><a href="#extracting-variables-as-vectors" id="toc-extracting-variables-as-vectors" class="nav-link" data-scroll-target="#extracting-variables-as-vectors"><span class="toc-section-number">3.6</span>  Extracting Variables as Vectors</a></li>
  <li><a href="#selecting-rows-and-variables-to-answer-specific-questions" id="toc-selecting-rows-and-variables-to-answer-specific-questions" class="nav-link" data-scroll-target="#selecting-rows-and-variables-to-answer-specific-questions"><span class="toc-section-number">3.7</span>  Selecting Rows and Variables to Answer Specific Questions</a></li>
  <li><a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables"><span class="toc-section-number">3.8</span>  Creating New Variables</a></li>
  <li><a href="#compare-war-groups-with-respect-to-babip" id="toc-compare-war-groups-with-respect-to-babip" class="nav-link" data-scroll-target="#compare-war-groups-with-respect-to-babip"><span class="toc-section-number">3.9</span>  Compare WAR Groups with Respect to BABIP</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next"><span class="toc-section-number">3.10</span>  What’s Next?</a></li>
  </ul></li>
  <li><a href="#part-3---graphs-of-relationships" id="toc-part-3---graphs-of-relationships" class="nav-link" data-scroll-target="#part-3---graphs-of-relationships"><span class="toc-section-number">4</span>  Part 3 - Graphs of Relationships</a>
  <ul class="collapse">
  <li><a href="#introduction-3" id="toc-introduction-3" class="nav-link" data-scroll-target="#introduction-3"><span class="toc-section-number">4.1</span>  Introduction</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="toc-section-number">4.2</span>  Questions</a></li>
  <li><a href="#comparing-groups" id="toc-comparing-groups" class="nav-link" data-scroll-target="#comparing-groups"><span class="toc-section-number">4.3</span>  Comparing Groups</a></li>
  <li><a href="#relating-numeric-variables" id="toc-relating-numeric-variables" class="nav-link" data-scroll-target="#relating-numeric-variables"><span class="toc-section-number">4.4</span>  Relating Numeric Variables</a></li>
  <li><a href="#describing-the-relationship" id="toc-describing-the-relationship" class="nav-link" data-scroll-target="#describing-the-relationship"><span class="toc-section-number">4.5</span>  Describing the Relationship</a></li>
  <li><a href="#looking-deeper" id="toc-looking-deeper" class="nav-link" data-scroll-target="#looking-deeper"><span class="toc-section-number">4.6</span>  Looking Deeper</a></li>
  <li><a href="#summary-and-whats-next" id="toc-summary-and-whats-next" class="nav-link" data-scroll-target="#summary-and-whats-next"><span class="toc-section-number">4.7</span>  Summary and What’s Next</a></li>
  </ul></li>
  <li><a href="#part-4---the-data.table-package" id="toc-part-4---the-data.table-package" class="nav-link" data-scroll-target="#part-4---the-data.table-package"><span class="toc-section-number">5</span>  Part 4 - The data.table Package</a>
  <ul class="collapse">
  <li><a href="#will-we-see-baseball-in-2020" id="toc-will-we-see-baseball-in-2020" class="nav-link" data-scroll-target="#will-we-see-baseball-in-2020"><span class="toc-section-number">5.1</span>  Will We See Baseball in 2020?</a></li>
  <li><a href="#introduction-to-data.table" id="toc-introduction-to-data.table" class="nav-link" data-scroll-target="#introduction-to-data.table"><span class="toc-section-number">5.2</span>  Introduction to data.table</a></li>
  <li><a href="#reading-in-some-statcast-data" id="toc-reading-in-some-statcast-data" class="nav-link" data-scroll-target="#reading-in-some-statcast-data"><span class="toc-section-number">5.3</span>  Reading in Some Statcast Data</a></li>
  <li><a href="#what-is-a-data.table" id="toc-what-is-a-data.table" class="nav-link" data-scroll-target="#what-is-a-data.table"><span class="toc-section-number">5.4</span>  What is a data.table?</a></li>
  <li><a href="#data.table-basic-syntax" id="toc-data.table-basic-syntax" class="nav-link" data-scroll-target="#data.table-basic-syntax"><span class="toc-section-number">5.5</span>  data.table Basic Syntax</a></li>
  <li><a href="#selecting-rows" id="toc-selecting-rows" class="nav-link" data-scroll-target="#selecting-rows"><span class="toc-section-number">5.6</span>  Selecting Rows</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables"><span class="toc-section-number">5.7</span>  Selecting Variables</a></li>
  <li><a href="#computing-summaries-and-summaries-by-group" id="toc-computing-summaries-and-summaries-by-group" class="nav-link" data-scroll-target="#computing-summaries-and-summaries-by-group"><span class="toc-section-number">5.8</span>  Computing Summaries and Summaries by Group</a></li>
  <li><a href="#swing-and-miss-study" id="toc-swing-and-miss-study" class="nav-link" data-scroll-target="#swing-and-miss-study"><span class="toc-section-number">5.9</span>  Swing and Miss Study</a></li>
  <li><a href="#some-preliminaries" id="toc-some-preliminaries" class="nav-link" data-scroll-target="#some-preliminaries"><span class="toc-section-number">5.10</span>  Some Preliminaries</a></li>
  <li><a href="#swinging-by-count" id="toc-swinging-by-count" class="nav-link" data-scroll-target="#swinging-by-count"><span class="toc-section-number">5.11</span>  Swinging by Count</a></li>
  <li><a href="#making-contact-by-count" id="toc-making-contact-by-count" class="nav-link" data-scroll-target="#making-contact-by-count"><span class="toc-section-number">5.12</span>  Making Contact by Count</a></li>
  <li><a href="#hitting-a-line-drive-by-count" id="toc-hitting-a-line-drive-by-count" class="nav-link" data-scroll-target="#hitting-a-line-drive-by-count"><span class="toc-section-number">5.13</span>  Hitting a Line Drive by Count</a></li>
  <li><a href="#why-do-i-like-data-table" id="toc-why-do-i-like-data-table" class="nav-link" data-scroll-target="#why-do-i-like-data-table"><span class="toc-section-number">5.14</span>  Why Do I Like data table?</a></li>
  </ul></li>
  <li><a href="#part-5---comparing-two-pitchers-using-ggplot2" id="toc-part-5---comparing-two-pitchers-using-ggplot2" class="nav-link" data-scroll-target="#part-5---comparing-two-pitchers-using-ggplot2"><span class="toc-section-number">6</span>  Part 5 - Comparing Two Pitchers Using ggplot2</a>
  <ul class="collapse">
  <li><a href="#introduction-4" id="toc-introduction-4" class="nav-link" data-scroll-target="#introduction-4"><span class="toc-section-number">6.1</span>  Introduction</a></li>
  <li><a href="#comparing-two-2017-phillies-starters" id="toc-comparing-two-2017-phillies-starters" class="nav-link" data-scroll-target="#comparing-two-2017-phillies-starters"><span class="toc-section-number">6.2</span>  Comparing Two 2017 Phillies Starters</a></li>
  <li><a href="#starting-with-ggplot2" id="toc-starting-with-ggplot2" class="nav-link" data-scroll-target="#starting-with-ggplot2"><span class="toc-section-number">6.3</span>  Starting with ggplot2</a></li>
  <li><a href="#comparing-groups-1" id="toc-comparing-groups-1" class="nav-link" data-scroll-target="#comparing-groups-1"><span class="toc-section-number">6.4</span>  Comparing groups</a></li>
  <li><a href="#scatterplots" id="toc-scatterplots" class="nav-link" data-scroll-target="#scatterplots"><span class="toc-section-number">6.5</span>  Scatterplots</a></li>
  <li><a href="#balls-put-in-play" id="toc-balls-put-in-play" class="nav-link" data-scroll-target="#balls-put-in-play"><span class="toc-section-number">6.6</span>  Balls put in play</a></li>
  <li><a href="#takeaways" id="toc-takeaways" class="nav-link" data-scroll-target="#takeaways"><span class="toc-section-number">6.7</span>  Takeaways</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Welcome to R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jim Albert </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 6, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<section id="learning-r" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="learning-r"><span class="header-section-number">1.1</span> Learning R</h3>
<p>I’ve been writing posts on this site for awhile and you know my style. I start with a baseball question and try to answer the question using R work and modeling and associated graphical displays. I usually provide some R code which helps some people do their own explorations. But I suspect that my posts don’t really help the interested new reader who wishes to learn R. So I thought it would be helpful to have a series of tutorial posts called “Welcome to R” introducing R and RStudio directed to the person who wants to get started.</p>
</section>
<section id="i-am-not-using-tidyverse" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="i-am-not-using-tidyverse"><span class="header-section-number">1.2</span> I am not using tidyverse</h3>
<p>That raises the obvious question – how to get started in R? I’ve taught R for many years, first for my graduate courses in statistics and more recently for undergraduate courses in data science. I started coding with S many years ago, I’ve written or cowritten three books that introduce R for different audiences, and so I have done a bit of thinking of how best to introduce R from a pedagogical perspective.</p>
<p>One popular general approach for learning R is based on the tidyverse suite of R packages. As described by its main developer Hadley Wickham, tidyverse is an opinionated collection of R packages designed for data science. I have used tidyverse packages, especially dplyr, in my data science teaching in the past. In fact, I have used the R for Data Science text by Wickham and Grolemund to introduce R for the first data science course at BGSU. The tidyverse collection is embraced by RStudio and many other people as a great way of learning R.</p>
<p>But I don’t plan on using tidyverse in this introduction to R.</p>
<p>Why? I found at BGSU that my data science students who learned tidyverse had gaps in their knowledge of R. After taking my tidyverse course, they didn’t know how to write a loop or write simple functions and they got frustrated when their tidyverse code didn’t work. (They didn’t have a backup plan.) They really didn’t understand vectors and matrices, although those objects are building blocks in R.</p>
<p>One difficulty in learning any new programming language is the syntax especially when there are many new function names to learn. Base R is hard enough, but tidyverse adds hundreds of new functions to learn. By the way, there are other tidyverse skeptics out there – for example, Norm Matloff and Jasper McChesney – and Matloff is an experienced teacher and writer of the R language.</p>
<p>That raises the question – is tidyverse really a good way of learning R? Honestly, I have my doubts. It would be interesting to design an experiment to assess the comparative value of tidyverse and base R functions in learning R. Statistics educators think about the best way to communicate statistical inference – why shouldn’t data science educators think about best ways of teaching coding for data science?</p>
</section>
<section id="my-approach-in-welcome-to-r" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="my-approach-in-welcome-to-r"><span class="header-section-number">1.3</span> My Approach in Welcome to R</h3>
<p>I plan on introducing R, focusing not on tidyverse, but rather on the exploration and graphing functions available in base R. Here are some things that I’ll discuss in this tutorial:</p>
<ul>
<li><p>Installing R and RStudio. Getting familiar with the RStudio environment.</p></li>
<li><p>Data types and containers (such as vectors) for the data.</p></li>
<li><p>Importing a csv file downloaded from FanGraphs.</p></li>
<li><p>Working with data frames.</p></li>
<li><p>Summarizing and graphing character and numerical data.</p></li>
<li><p>Exploring relationships.</p></li>
<li><p>Getting started with <code>ggplot2</code> graphing (by the way, <code>ggplot2</code> is not part of the tidyverse suite of packages)</p></li>
</ul>
</section>
<section id="some-other-comments" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="some-other-comments"><span class="header-section-number">1.4</span> Some other comments:</h3>
<ul>
<li><p>I’ll pose some questions for you to try on your own.</p></li>
<li><p>All of the material will be posted as Markdown files.</p></li>
<li><p>Last, this will be fun since I will be talking about all of the R topics in the context baseball.</p></li>
</ul>
</section>
<section id="the-goal" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="the-goal"><span class="header-section-number">1.5</span> The Goal</h3>
<p>One approach to learning R is to just dive in. For example, you might get hold of our Analyzing Baseball Data with R book and jump to a particular chapter of interest like runs expectancy and try running code. That is not a good approach for most people. In this Welcome to R tutorial, I am not going to dive into some sophisticated analysis. I will assume little previous knowledge of programming and the goal is to gain familiarity with some basic R functions so you can start to do interesting baseball work.</p>
</section>
</section>
<section id="part-i---working-with-vectors" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="part-i---working-with-vectors"><span class="header-section-number">2</span> Part I - Working with Vectors</h2>
<section id="introduction-1" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">2.1</span> Introduction</h3>
<p>Here’s my first “Welcome to R” post. I will briefly describe the process of installing R and RStudio and the RStudio interface where you do your R work. Then I will give a description of vectors which is a basic data component in R. Using Roy Halladay data, I’ll illustrate some manipulations with vectors and some basic graphs of character and numerical data.</p>
<p>By the way, you find little discussion of vectors when you read introductions to tidyverse, but I think this is a good way to get introduced to computations in R.</p>
</section>
<section id="getting-started-with-r-and-rstudio" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="getting-started-with-r-and-rstudio"><span class="header-section-number">2.2</span> Getting Started with R and RStudio</h3>
<p>To get started you need to install R from CRAN and RStudio from the Rstudio download site (make sure you choose Windows or Mac depending on your computer). Once both R and RStudio are installed, then you launch R by opening up RStudio and you should see an interface similar to what is shown below.</p>
<p><img src="figures/welcome/welcome1.png" class="img-fluid" style="width:70.0%"></p>
<p>The bottom left window is the Console window – you can type in commands like 1 + 2 and you’ll see a result. In the top left window, you can create a listing of R commands, called a R script – this is helpful if you want to save your R work. The bottom right panel is where you see graphical output and other things. What you see in the bottom right panel below is the output from knitting a Markdown file which I will introduce next.</p>
</section>
<section id="r-markdown-files" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="r-markdown-files"><span class="header-section-number">2.3</span> R Markdown Files</h3>
<p>What you currently see in the top left window is a R Markdown file. This is a convenient way of blending text and R work. When this file is run or “knitted”, then you have a nice document (by default it is html, but it could be Word or pdf) containing all of the text and R output. I don’t do much Python or Mathematica, but a R Markdown document is similar to a Python or Mathematica notebook.</p>
<p>All of the work and the accompanying explanation for each of my tutorial sessions will be placed in a Markdown file located on my Github Gist site. You can open up this file in RStudio and knit this (by pushing the knit button) to produce all of the output in this post.</p>
</section>
<section id="vectors" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="vectors"><span class="header-section-number">2.4</span> Vectors</h3>
<p>A good place to start learning R is by working with vectors. A vector is a collection of data of a specific type such as numeric or character. (Numeric refers to measurements like a ERA and character refers to a string such as a player’s name.) Vectors are quick to define and R has a large number of functions for summarizing and graphing vectors. I’ll illustrate creating and working with vectors with some baseball data.</p>
<p>Let’s look at the famous pitcher Roy Halladay who was recently inducted in the baseball Hall of Fame. From Baseball-Reference, I collected his WAR statistics from 1999 through 2013 and place them in a vector and store into a variable called WAR. (We see our first R function c() where the c indicates we are combining values into a vector.)</p>
<pre><code>WAR &lt;- c(2.6, -2.8, 3.0, 7.3, 8.1, 2.4,
         5.5, 5.3, 3.5, 6.2, 6.9, 8.5,
         8.8, 0.8, -1.1)</code></pre>
<p>I create another vector of corresponding seasons. The function seq() is helpful in creating a regularly spaced sequence of seasons from 1999 to 2013.</p>
<pre><code>Season &lt;- seq(1999, 2013)</code></pre>
<p>Next we create a character vector Team containing the teams that Halladay played for those 15 seasons. The function rep() will repeat an argument several times. (For example, rep(“PHI”, 4) is the same as c(“PHI”, “PHI”, “PHI”, “PHI”).)</p>
<pre><code>Team &lt;- c(rep("TOR", 11), rep("PHI", 4))</code></pre>
</section>
<section id="vector-indices" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="vector-indices"><span class="header-section-number">2.5</span> Vector Indices</h3>
<p>To illustrate different operations with vectors, we define a new vector variable <code>GS</code> containing the number of games started for Halladay for these 15 seasons.</p>
<pre><code>GS &lt;- c(18, 13, 16, 34, 36, 21, 19, 32, 
        31, 33, 32, 33, 32, 25, 13)</code></pre>
<p>One uses square bracket notation([]) to choose particular values of a vector. For example, the 3rd value of GS is</p>
<pre><code>GS[3]
[1] 16</code></pre>
<p>The 2nd, 3rd, and 7th values of GS are:</p>
<pre><code>GS[c(2, 3, 7)]
[1] 13 16 19</code></pre>
<p>A convenient way to find a subset of a vector that satisfies a logical condition is by logical operators. The following expression <code>GS &gt; 30</code> defines a logical vector of the indices of GS where Halladay started more than 30 games.</p>
<pre><code>GS &gt; 30
[1] FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE
 [8]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
[15] FALSE</code></pre>
<p>By using this logical condition together with the square bracket notation, we can find the seasons where Halladay started more than 30 games.</p>
<pre><code>Season[GS &gt; 30]
[1] 2002 2003 2006 2007 2008 2009 2010 2011</code></pre>
<p>What was the season when Halladay obtained his maximum WAR? First we identify by a logical value the WAR value which is the max (I’m illustrating the use of the R function <code>max()</code>.)</p>
<pre><code>WAR == max(WAR)
 [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [8] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
[15] FALSE</code></pre>
<p>(Note the use of a double equals sign to indicate logical equality.). Then we use this logical vector with the bracket notation to obtain the corresponding season. We see that Halladay’s best WAR season was 2011.</p>
<pre><code>Season[WAR == max(WAR)]
[1] 2011</code></pre>
</section>
<section id="vector-operations" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="vector-operations"><span class="header-section-number">2.6</span> Vector Operations</h3>
<p>One can perform vector arithmetic in R where you have two vectors and you perform element-by-element arithmetic. For example, suppose you want to compute a new measure, WAR_per_GS defined by WAR divided by GS. We can do this easily from the vectors WAR and GS:</p>
<pre><code>WAR_per_GS &lt;- WAR / GS
WAR_per_GS
 [1]  0.1444 -0.2154  0.1875  0.2147  0.2250
 [6]  0.1143  0.2895  0.1656  0.1129  0.1879
[11]  0.2156  0.2576  0.2750  0.0320 -0.0846</code></pre>
<p>There are many R functions that will take a vector as an argument and output a single value. For example, we can obtain Halladay cumulative WAR for these 15 seasons by use of the <code>sum()</code> function.</p>
<pre><code>sum(WAR)
65</code></pre>
<p>Let’s compare Halladay’s cumulative WAR for his two teams. Clearly, Halladay had more total success when he played for Toronto.</p>
<pre><code>sum(WAR[Team == "TOR"])
sum(WAR[Team == "PHI"])
[1] 48
[1] 17</code></pre>
<p>There are many similar functions like <code>max()</code>, <code>min()</code>, <code>mean()</code>, <code>sd()</code>, etc.</p>
</section>
<section id="graphs-of-vector-data" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="graphs-of-vector-data"><span class="header-section-number">2.7</span> Graphs of Vector Data</h3>
<p>A basic graph of the WAR values is a one-dimensional scatterplot created by the function <code>stripchart()</code>. The pch = 19 will choose a solid circle as the plotting point. Halladay had 8 seasons where his WAR value exceeded 5. Note his two negative WAR seasons.</p>
<p><code>stripchart(WAR, pch = 19)</code></p>
<p><img src="figures/welcome/welcome2.png" class="img-fluid" style="width:70.0%"></p>
<p>By the way, another common graph of numeric data is a histogram. We create a histogram of Halladay’s WAR values by the <code>hist()</code> function.</p>
<pre><code>hist(WAR)</code></pre>
<p><img src="figures/welcome/welcome3.png" class="img-fluid" style="width:70.0%"></p>
<p>How did Halladay’s WAR values change over his career? We can answer this by a scatterplot with Season on the horizontal scale and WAR on the vertical. Note that Halladay’s worst seasons were in 2000 and his final two seasons.</p>
<pre><code>plot(Season, WAR)</code></pre>
<p><img src="figures/welcome/welcome4.png" class="img-fluid" style="width:70.0%"></p>
<p>What teams did Halladay play for? We first create a table of frequencies using the <code>table()</code> function and then construct a bar graph of the table using the <code>barplot()</code> function. We see that he spent most of his career with the Blue Jays.</p>
<pre><code>table(Team)
Team
PHI TOR 
  4  11 </code></pre>
<pre><code>barplot(table(Team))</code></pre>
<p><img src="figures/welcome/welcome5.png" class="img-fluid" style="width:70.0%"></p>
<p>Did Halladay play better for Philly or Toronto? We’ll answer this question by constructing a stripchart of WAR by Team. Although most of Halladay’s success was with the Blue Jays, note the two remarkably great seasons with the Phillies.</p>
<pre><code>stripchart(WAR ~ Team, pch = 19)</code></pre>
<p><img src="figures/welcome/welcome6.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="summary-and-looking-forward" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="summary-and-looking-forward"><span class="header-section-number">2.8</span> Summary and Looking Forward</h3>
<p>The goal of this first “Welcome to R” session was to introduce vectors for numeric or character data and illustrate a few of the many functions available indexing, summarizing, and graphing data from vectors.</p>
<p>If you look at the Markdown file located on my Github Gist site, you’ll see a “Things to Try on Your Own” section where I pose some questions that can be answered by working with vectors. One learns a lot by trying out things – coding is not a spectator sport.</p>
<p>Vectors actually are the building blocks for a main R object called a data frame. In my next post, I will illustrate reading in a csv file from a FanGraphs statistics page and illustrate some basic manipulations for data frames.</p>
</section>
</section>
<section id="part-2---importing-data-and-data-frames" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="part-2---importing-data-and-data-frames"><span class="header-section-number">3</span> Part 2 - Importing Data and Data Frames</h2>
<section id="introduction-2" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="introduction-2"><span class="header-section-number">3.1</span> Introduction</h3>
<p>In Part 1 of this Welcome to R series, I looked at a vector which is a key object in R. In this Part 2 post, I will introduce a data frame which is a fundamental way of storing data of different types. As motivation, I’ll describe how one can import a FanGraphs table into R and then illustrate various manipulations with the pitching statistics data frame.</p>
</section>
<section id="importing-a-fangraphs-dataset-into-r" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="importing-a-fangraphs-dataset-into-r"><span class="header-section-number">3.2</span> Importing a FanGraphs Dataset into R</h3>
<p>The FanGraphs website contains a lot of interesting tables. Let’s focus on a particular page that provides many statistics for the group of 2019 starting pitchers. Looking at the table, pictured below, we see an “Export Data” button on the right hand side above the table. By clicking on this, one is able to save a csv (common-separated text file) version of this table to one’s laptop. This is a common data type that is easy to import into R or other statistical programs.</p>
<p><img src="figures/welcome/welcome7.png" class="img-fluid" style="width:70.0%"></p>
<p>Next we open up R (through RStudio). Above the top right window, we see a “Import Dataset” button that we press. (See the picture below to see the location of this button.)</p>
<p><img src="figures/welcome/welcome8.png" class="img-fluid" style="width:70.0%"></p>
<p>We now see a menu that provides imports of different data types – we indicate that we will be reading in a Text file and using the readr package to read in the data.</p>
<p><img src="figures/welcome/welcome9.png" class="img-fluid" style="width:70.0%"></p>
<p>After you indicate the file name (by choosing Browse and finding the csv file on your computer), you will see the following window. By default, this <code>read_csv()</code> function will assume that the variable names are in the first row of the dataset. Also by default the file will be saved using the name “FanGraphs_Leaderboard” since that was the name of that file. Since we will be typing in the dataset name in our work, I change the name (in the Import Options area) to the shorter “FG”. Assuming that the Data Preview screen looks reasonable (like it does here), select the Import button. The dataset will be read and stored as the data frame FG in the R workspace.</p>
<p><img src="figures/welcome/welcome10.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="some-data-cleaning" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="some-data-cleaning"><span class="header-section-number">3.3</span> Some Data Cleaning</h3>
<p>Before we do any work with our dataset, there are several data cleaning issues to take care of. Some of the variable names like K/9, HR/9, LOB%, GB%, and HR/FB contain special characters like / and % which will make it harder to refer to these variables. So I want to modify these variable names. A second issue is that the data for the variables LOB%, GB%, and HR/FB contain % signs and so they were imported as strings rather than numeric values. I’d like to strip the % characters from all of the values for these three variables and convert them to numeric form. By making these variables numeric, I will be able to find summaries and construct graphs designed for numeric data.</p>
<p>Let’s fix the variable names. The <code>names()</code> function returns a character vector containing the names of the variables in the data frame <code>FG</code>.</p>
<pre><code>names(FG)
 [1] "Name"     "Team"     "W"        "L"       
 [5] "SV"       "G"        "GS"       "IP"      
 [9] "K9"       "BB9"      "HR9"      "BABIP"   
[13] "LOB"      "GB"       "HR_FB"    "ERA"     
[17] "FIP"      "xFIP"     "WAR"      "playerid"</code></pre>
<p>Using vector index operations, the following statement changes the names for the six offending variables.</p>
<pre><code>names(FG)[c(9, 10, 11, 13, 14, 15)] &lt;-
   c("K9", "BB9", "HR9", "LOB", "GB", "HR_FB")</code></pre>
<p>Next, I want to fix those variables with percentage signs. To work with one variable of the data frame FG, I use the $ notation. So FG$LOB is a vector of LOB values for my 61 pitchers. The gsub() function will replace all occurrences of “%” with a blank character, and the as.numeric() function will convert the string variable to a numeric variable.</p>
<pre><code>FG$LOB &lt;- gsub("%", "", FG$LOB)
FG$LOB &lt;- as.numeric(FG$LOB)</code></pre>
<p>I repeat this operation using a single line for the other two variables (GB and HR_FB) which contain data with % signs.</p>
<pre><code>FG$GB &lt;- as.numeric(gsub("%", "", FG$GB))
FG$HR_FB &lt;- as.numeric(gsub("%", "", FG$HR_FB))</code></pre>
</section>
<section id="data-frames" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="data-frames"><span class="header-section-number">3.4</span> Data Frames</h3>
<p>The data for our 61 starting pitchers is currently stored in a data frame which is the main way of representing data in R. Basically, a data frame is a special type of matrix where rows of the data frame correspond to observations (pitchers) and columns of the data frame correspond to variables (measures such as Name, W, L, etc).</p>
</section>
<section id="selecting-rows-and-columns" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="selecting-rows-and-columns"><span class="header-section-number">3.5</span> Selecting Rows and Columns</h3>
<p>Remember the bracket notation that we used to select elements of a vector from the last lesson? We can use similar bracket notation to select rows and columns from the data frame. For example</p>
<pre><code>FG[2, ]</code></pre>
<p>extracts the statistics for the 2nd row (pitcher). I can select the variables 2, 3, and 5 from the data frame (that is, the 2nd, 3rd, and 5th columns) by entering</p>
<pre><code>FG[, c(2, 3, 5)]</code></pre>
<p>or using the variable names in quotes</p>
<pre><code>FG[, c("Team", "W", "SV")]</code></pre>
<p>Note that these commands result in data frames of a smaller size. For example, the last example results in a data frame with 61 rows and 3 columns.</p>
</section>
<section id="extracting-variables-as-vectors" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="extracting-variables-as-vectors"><span class="header-section-number">3.6</span> Extracting Variables as Vectors</h3>
<p>The <code>$</code> notation is used to extract specific variables from a data frame – the outcome will be a vector of values of the variable. If you type <code>FG$</code> in the Console Window, RStudio will show you a menu with all of the variable names in the data frame. If you select W, for example, the object FG$W will give you a vector of win counts for all pitchers.</p>
<p><img src="figures/welcome/welcome11.png" class="img-fluid" style="width:30.0%"></p>
</section>
<section id="selecting-rows-and-variables-to-answer-specific-questions" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="selecting-rows-and-variables-to-answer-specific-questions"><span class="header-section-number">3.7</span> Selecting Rows and Variables to Answer Specific Questions</h3>
<p>By use of logical variables, one can extract specific rows of a data frame using the bracket notation to answer questions of interest. We’ll illustrate with some examples. In each case I am using [] to find the row or rows of interest and then using $ to extract the variable of interest.</p>
<p>Which pitcher let up the most home runs per 9 innings? Here we use logical equality to find the row of the data frame where the HR9 value is the highest. Then I extract the Name variable using the $ notation.</p>
<pre><code>FG[FG$HR9 == max(FG$HR9), ]$Name
[1] "Matthew Boyd"</code></pre>
<p>Which pitcher had the fewest walks per nine innings? Using a similar idea, I find the row of the data frame where the BB9 is the smallest and then extract the name of the pitcher in that row.</p>
<pre><code>FG[FG$BB9 == min(FG$BB9), ]$Name
[1] "Hyun-Jin Ryu"</code></pre>
<p>Which pitchers won at least 16 games and walked less than 2 batters in 9 innings? Here I find the rows of the data frame where W &gt; 14 and (note the &amp; symbol) BB9 &lt; 2, and then I extract the Name variable. We see that Verlander and Greinke satisfy these criteria.</p>
<pre><code>FG[FG$W &gt;= 16 &amp; FG$BB9 &lt; 2, ]$Name
[1] "Justin Verlander" "Zack Greinke" </code></pre>
<p>Who were the top five in strikeouts per 9 innings? Here I sort the rows of the data frame in descending order by the K9 variable (using the <code>order()</code> function), find the first five rows using the bracket symbol, and then extract the <code>Name</code> variable for these rows.</p>
<pre><code>FG[order(-FG$K9), ][1:5, ]$Name
[1] "Gerrit Cole"      "Max Scherzer"    
[3] "Robbie Ray"       "Justin Verlander"
[5] "Lucas Giolito"</code></pre>
</section>
<section id="creating-new-variables" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="creating-new-variables"><span class="header-section-number">3.8</span> Creating New Variables</h3>
<p>One can add new variables simply by defining a new data frame variable as functions of other variables. Here I define a new character variable Group that is “Top” if the WAR value is larger than 3.3, and “Bottom” otherwise. (By the way, 3.3 was the median WAR value in this group.)</p>
<pre><code>FG$Group &lt;- ifelse(FG$WAR &gt; 3.3, "Top", "Bottom")</code></pre>
</section>
<section id="compare-war-groups-with-respect-to-babip" class="level3" data-number="3.9">
<h3 data-number="3.9" class="anchored" data-anchor-id="compare-war-groups-with-respect-to-babip"><span class="header-section-number">3.9</span> Compare WAR Groups with Respect to BABIP</h3>
<p>Here’s an interesting question – do the Top and Bottom groups differ with respect to W or BABIP? By use of the <code>by()</code> function, I find summary statistics for both variables. (The <code>by()</code> function has three inputs – a data frame, a grouping variable, and a measure that will be applied to each group.) From the output, we see the top pitchers tend to win 3 more games, on average, than the bottom pitchers. But the median BABIPs for the two groups are very similar, which seems to indicate that BABIP is not the best measure for distinguishing pitcher quality.</p>
<pre><code>by(FG[, c("W", "BABIP")], FG$Group, summary)

FG$Group: Bottom
       W             BABIP       
 Min.   : 6.00   Min.   :0.2400  
 1st Qu.: 9.75   1st Qu.:0.2737  
 Median :11.00   Median :0.2925  
 Mean   :11.12   Mean   :0.2935  
 3rd Qu.:13.00   3rd Qu.:0.3100  
 Max.   :17.00   Max.   :0.3470  
------------------------------------------ 
FG$Group: Top
       W             BABIP       
 Min.   :10.00   Min.   :0.2180  
 1st Qu.:11.00   1st Qu.:0.2740  
 Median :14.00   Median :0.2900  
 Mean   :14.14   Mean   :0.2872  
 3rd Qu.:16.00   3rd Qu.:0.3040  
 Max.   :21.00   Max.   :0.3260  </code></pre>
</section>
<section id="whats-next" class="level3" data-number="3.10">
<h3 data-number="3.10" class="anchored" data-anchor-id="whats-next"><span class="header-section-number">3.10</span> What’s Next?</h3>
<p>Now we have some basic understanding of data frames, on Wednesday I will provide an overview of graphical methods that one can use to look at relationships between the variables.</p>
<p>All of today’s work is contained in a R Markdown document on Github gist. At the end of this document, I provide a “further exploration” section where I suggest another analysis to try using some FanGraphs batting data.</p>
</section>
</section>
<section id="part-3---graphs-of-relationships" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="part-3---graphs-of-relationships"><span class="header-section-number">4</span> Part 3 - Graphs of Relationships</h2>
<section id="introduction-3" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="introduction-3"><span class="header-section-number">4.1</span> Introduction</h3>
<p>This is the third post in my Welcome to R series. In Welcome to R - Part 1, I focused on vectors, basic structures in R. In Welcome to R - Part 2, I imported a Fan Graphs table that listed a number of statistics for the group of 2019 starting pitchers. This Part 2 illustrated some basic manipulations with data frames. I will continue with this Fan Graphs example to illustrate some graphs available in the base package in R. We’ll see which variables among <code>BABIP, K9, BB9, HR9</code> appear to explain most of the variation in the WAR values of these 62 starters.</p>
</section>
<section id="questions" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="questions"><span class="header-section-number">4.2</span> Questions</h3>
<p>We are working with a FanGraphs data frame of 62 starting pitchers for the 2019 season. This data frame includes (1) <code>BABIP</code>, batting average on balls in play, (2) <code>K9</code>, average number of strikeouts per nine innings, (3) <code>BB9</code>, average number of walks per nine innings, (4) <code>HR9</code>, average number of home runs allowed per nine innings, and (5) <code>WAR</code>, the total wins above replacement. Which variables among <code>BABIP</code>, <code>K9</code>, <code>BB9</code>, and <code>HR9</code> are most helpful for explaining the variability in the <code>WAR</code> values for these 62 pitchers?</p>
</section>
<section id="comparing-groups" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="comparing-groups"><span class="header-section-number">4.3</span> Comparing Groups</h3>
<p>As in the previous post, I define a new variable <code>Group</code> which is defined to be “High” if the <code>WAR</code> value is larger than 3.3 or “Low” otherwise.</p>
<pre><code>FG$Group &lt;- ifelse(FG$WAR &gt; 3.3, "Top", "Bottom")</code></pre>
<p>Which variables among <code>BABIP</code>, <code>K9</code>, <code>BB9</code>, <code>HR9</code> are helpful in distinguishing the Top and Bottom <code>WAR</code> pitchers?</p>
<p>Let’s focus on the strikeout variable <code>K9</code>. One basic graph, created by the R function <code>stripchart()</code>, plots parallel one-dimensional scatterplots of <code>K9</code> for the Bottom and Top <code>WAR</code> groups. Note that in the code I indicate that the variables <code>K9</code> and <code>Group</code> are in the data frame <code>FG</code> by the <code>data = FG</code> argument and I jitter the plotted points by the <code>method = "jitter"</code> argument. Note that the Top <code>WAR</code> group tends to strike out more batters than the Bottom <code>WAR</code> group.</p>
<pre><code>stripchart(K9 ~ Group, 
           data = FG,
           method = "jitter")</code></pre>
<p><img src="figures/welcome/welcome12.png" class="img-fluid" style="width:70.0%"></p>
<p>One can get a better idea how <code>K9</code> is related to <code>Group</code> by plotting parallel boxplots of <code>K9</code> for the two groups. We use the function <code>boxplot()</code> which has a similar syntax to <code>stripchart()</code>. By use of the horizontal = TRUE argument, the boxes are displayed in a horizontal fashion.</p>
<pre><code>boxplot(K9 ~ Group, 
           data = FG,
           horizontal = TRUE)</code></pre>
<p><img src="figures/welcome/welcome13.png" class="img-fluid" style="width:70.0%"></p>
<p>Each box shows the location of the median (solid vertical line) and the quartiles (vertical lines on the left and right of box) for the <code>K9</code> values for a particular group. The dotted lines extend to the extreme values (LO and HI) for the <code>K9</code> variable. Special outliers are plotted separately as dots. We see that the median <code>K9</code> values for the Top <code>WAR</code> and Bottom <code>WAR</code> groups are respectively 10 and 8. So the Top <code>WAR</code> group tends to strike out 2 more batters per 9 innings than the Bottom <code>WAR</code> group. There are actually three outliers – these correspond to pitchers in the Low <code>WAR</code> group that strike out a lot of batters. (It would be interesting to identify these pitchers.)</p>
</section>
<section id="relating-numeric-variables" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="relating-numeric-variables"><span class="header-section-number">4.4</span> Relating Numeric Variables</h3>
<p>A scatterplot is a basic graph where one plots ordered pairs of two numeric variables. Since we are dealing with 5 variables (<code>BABIP, K9, BB9, HR9, WAR</code>), one might be interested in constructing scatterplots for all pairs among these variables. This is conveniently done by using the <code>plot()</code> function where the argument is the data frame with only these variables. There are 20 plots shown – note that each plot of two variables is shown twice.</p>
<pre><code>plot(FG[, c("BABIP", "K9", "BB9", "HR9", "WAR")])</code></pre>
<p><img src="figures/welcome/welcome14.png" class="img-fluid" style="width:70.0%"></p>
<p>What variable among <code>BABIP, K9, BB9 and HR9</code> has the strongest relationship with <code>WAR</code>? To answer this question, we focus on the bottom row of scatterplots. As expected <code>K9</code> has a relatively strong positive relationship with <code>WAR</code>, both <code>BB9</code> and <code>HR9</code> have negative relationships with <code>WAR</code>, and <code>BABIP</code> and <code>WAR</code> appear to have a weak relationship. One can quantify these relationships by computing correlations by use of the <code>cor()</code> function with the same argument.</p>
<pre><code>cor(FG[, c("BABIP", "K9", "BB9", "HR9", "WAR")])</code></pre>
<p><img src="figures/welcome/welcome18.png" class="img-fluid" style="width:70.0%"></p>
<p>Correlations fall between -1 and 1 and the strongest relationships correspond to correlation values close to -1 or 1. Again looking at the bottom row, <code>K9</code> has the strongest relationship with <code>WAR</code> with a 0.7 correlation, followed by <code>HR9</code> (-0.51), <code>BB9</code> (-0.42), and <code>BABIP</code> (-0.10).</p>
</section>
<section id="describing-the-relationship" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="describing-the-relationship"><span class="header-section-number">4.5</span> Describing the Relationship</h3>
<p>Let’s focus on the relationship between <code>K9</code> and <code>WAR</code> – we produce a scatterplot by the <code>plot()</code> function.</p>
<pre><code>plot(FG$K9, FG$WAR)</code></pre>
<p><img src="figures/welcome/welcome15.png" class="img-fluid" style="width:70.0%"></p>
<p>Since the pattern of the relationship looks pretty linear, let’s fit a line. We can use the workhorse function <code>lm()</code> that we use for fitting regression models. The basic syntax is <code>y ~ x</code> where <code>x</code> and <code>y</code> are both variables in a data frame. We store all of the calculations in the variable fit.</p>
<pre><code>fit &lt;- lm(WAR ~ K9, data = FG)</code></pre>
<p>We can add the least-squares fit to the scatterplot by the <code>abline()</code> function with argument fit. I also indicate by the argument <code>col = "red"</code> that I want the plotted line to be red.</p>
<pre><code>plot(FG$K9, FG$WAR)
abline(fit, col = "red)</code></pre>
<p><img src="figures/welcome/welcome16.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="looking-deeper" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="looking-deeper"><span class="header-section-number">4.6</span> Looking Deeper</h3>
<p>What is interesting to me about this scatterplot is not the positive relationship that is obvious, but the particular points (pitchers) that deviate far from the line. One can measure a deviation by a residual which is the vertical distance of the point from the line. The <code>lm()</code> object stored in the variable fit has many components – one of them is a vector of residuals. We plot the <code>K9</code> values against the residuals and add a horizontal line at 0.</p>
<pre><code>plot(FG$BABIP, fit$residuals)
abline(a = 0, b = 0, col = "red")</code></pre>
<p><img src="figures/welcome/welcome17.png" class="img-fluid" style="width:70.0%"></p>
<p>I’ve drawn a box around two points that correspond to large negative residuals. These two pitchers have much smaller WAR values than would be predicted by their high strikeout rates. Again, if we looked further, I’d be interested in the identities of these two pitchers.</p>
</section>
<section id="summary-and-whats-next" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="summary-and-whats-next"><span class="header-section-number">4.7</span> Summary and What’s Next</h3>
<p>The purpose of this post was to introduce popular R functions for studying relationships from the base package. Once the reader has a handle for reading in data and working with data frame, then it is pretty easy to use functions like <code>hist()</code>, <code>stripchart()</code>, <code>boxplot()</code>, and <code>plot()</code> to create these graphs.</p>
<p>If you want to recreate these graphs, a R Markdown file can be found on my Github Gist site.</p>
<p>Currently, I am planning a couple more posts in this Welcome to R series. I generally use the <code>ggplot2</code> package in my plots and so it would be worthwhile to introduce this package and show how one can graph three or four variables at once. Also I’d like to talk about the <code>data.table</code> package which really is a nice extension of the bracket notation that we used for vectors and data frames.</p>
</section>
</section>
<section id="part-4---the-data.table-package" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="part-4---the-data.table-package"><span class="header-section-number">5</span> Part 4 - The data.table Package</h2>
<section id="will-we-see-baseball-in-2020" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="will-we-see-baseball-in-2020"><span class="header-section-number">5.1</span> Will We See Baseball in 2020?</h3>
<p>It is disappointing to see the current breakdown in negotiations between the owners and the players. But at this time it appears that there will be a shortened 2020 baseball season where the number of games and playoff structure will be determined by Major League Baseball. I look forward to exploring current baseball data, although one wonders what it means for a team to be the champion of a shortened 2020 season.</p>
</section>
<section id="introduction-to-data.table" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="introduction-to-data.table"><span class="header-section-number">5.2</span> Introduction to data.table</h3>
<p>If you have been following my Welcome to R series, we have talked in parts 1, 2, and 3 about vectors, data frames, and graphical displays for studying relationships. In this Part 4 of the Welcome to R series, I will introduce the data.table package which is an enhancement on the default data frame structure in R for handling tabular data. The R community, especially the RStudio folks, embrace the tidyverse which includes the <code>dplyr</code> package for manipulations with data frames. But I think <code>data.table</code> is a very attractive alternative to <code>dplyr</code> used by many data scientists. The goal here is to introduce the basic <code>data.table</code> syntax and illustrate it on a small baseball study. I hope this will encourage the reader to try <code>data.table</code> out.</p>
</section>
<section id="reading-in-some-statcast-data" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="reading-in-some-statcast-data"><span class="header-section-number">5.3</span> Reading in Some Statcast Data</h3>
<p>In my <code>ABWRdata</code> package available on Github, I have included several datasets to accompany our <em>Analyzing Baseball Data with R book</em>. Using the <code>fread()</code> function in the data.table package, I can read in a Statcast dataset directly from my Github site. This dataset contains 100K records from the 2017 season – each row corresponds to a pitch – there are a total of 91 variables measured.</p>
<p>By default, the <code>fread()</code> function will save the result as a data table.</p>
<p>library(data.table) sc &lt;- fread(“https://raw.githubusercontent.com/bayesball/ABWRdata/master/data/statcast2017.txt”)</p>
</section>
<section id="what-is-a-data.table" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="what-is-a-data.table"><span class="header-section-number">5.4</span> What is a data.table?</h3>
<p>We are already familiar with a data frame in R. One can think of a data table as an enhanced version of a data frame, or maybe a data frame on steroids. A data table is also a data frame, so you can manipulate a data table in the same way as a data frame. But we’ll see that a data table has extra capabilities which makes it useful for performing data science operations quickly using a concise notation.</p>
</section>
<section id="data.table-basic-syntax" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="data.table-basic-syntax"><span class="header-section-number">5.5</span> data.table Basic Syntax</h3>
<p>We are already familiar with the bracket notation in a data frame – if we have a data frame, say <code>DF</code>, then <code>DF[i, j]</code> refers to rows <code>i</code> and variables <code>j</code>. In a data table DT, we have the general notation</p>
<pre><code>DT[i, j, by]</code></pre>
<p>where <code>i</code> indicates how we select rows, <code>j</code> indicates how we choose variables, and by indicates how we divide the data table by groups.</p>
<p>It seems best to illustrate these different operations by examples using our Statcast data table.</p>
</section>
<section id="selecting-rows" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="selecting-rows"><span class="header-section-number">5.6</span> Selecting Rows</h3>
<p>These examples will look familiar to those who use the bracket notation to select rows in data frames. First, I choose the rows where the player name is “Mike Trout”, in the second example, I choose the rows corresponding to fast ball pitches, and the third example selects the pitches thrown to Mike Trout that are curve balls. Note several things: (1) I can just use the variable name in the brackets (I don’t need to use the $ notation), (2) I don’t need an extra comma inside the brackets.</p>
<pre><code>sc[player_name == "Mike Trout"]
sc[pitch_type %in%
        c("FC", "FF", "FO", "FS", "FT")]
sc[player_name == "Mike Trout"
            &amp; pitch_type == "CU"]</code></pre>
</section>
<section id="selecting-variables" class="level3" data-number="5.7">
<h3 data-number="5.7" class="anchored" data-anchor-id="selecting-variables"><span class="header-section-number">5.7</span> Selecting Variables</h3>
<p>The <code>j</code> argument lets one select one or more variables from the data table. Below I first select the pitch type, and then I select four variables. Again note that I just use the variable name, and when I want to select more than one variable, I place the variable names inside .().</p>
<pre><code>sc[, pitch_type]
sc[, .(plate_x, plate_z, description, events)]</code></pre>
</section>
<section id="computing-summaries-and-summaries-by-group" class="level3" data-number="5.8">
<h3 data-number="5.8" class="anchored" data-anchor-id="computing-summaries-and-summaries-by-group"><span class="header-section-number">5.8</span> Computing Summaries and Summaries by Group</h3>
<p>Selecting rows and variables in data tables should look pretty familiar to R users. But the j argument can also be used to compute summaries. Here are a couple of examples.</p>
<p>First I want to compute the mean launch speed for all balls put in play (use type == “X” to select the rows in play).</p>
<pre><code>sc[type == "X", mean(launch_speed)]

[1] 86.69978</code></pre>
<p>Okay, the mean launch speed is 86.7 mph. How does the speed vary by the number of strikes in the count? To answer this question, we now use the <code>gp</code> argument – we add a .(strikes) value as the 3rd argument. The output below shows a mean launch speed for 0, 1, and 2 strikes. If the third argument is .(strikes, balls), it will produce the mean launch speed for each combination of strikes and balls.</p>
<pre><code>sc[type == "X", mean(launch_speed),
   .(strikes)]

strikes  V1
1   86.69287        
2   86.13330        
0   87.44394</code></pre>
</section>
<section id="swing-and-miss-study" class="level3" data-number="5.9">
<h3 data-number="5.9" class="anchored" data-anchor-id="swing-and-miss-study"><span class="header-section-number">5.9</span> Swing and Miss Study</h3>
<p>To illustrate using <code>data.table</code> in a small study, consider a player hitting a line drive. First, the batter has to decide to swing. Next, the batter has to make contact with the pitch. Finally, assuming that the batter swings and doesn’t miss the pitch, he hits a line drive. How does the likelihood of each of these three steps of this process depend on the count? We are interested in ordering the counts from most likely to least likely for each of these operations.</p>
</section>
<section id="some-preliminaries" class="level3" data-number="5.10">
<h3 data-number="5.10" class="anchored" data-anchor-id="some-preliminaries"><span class="header-section-number">5.10</span> Some Preliminaries</h3>
<p>First I construct vectors consisting of the swing and miss situations.</p>
<pre><code>swing_situations &lt;- c("hit_into_play", "foul",
                      "swinging_strike",
                      "swinging_strike_blocked",
                      "missed_bunt", "hit_into_play_no_out",
                      "foul_bunt", "foul_tip",
                      "hit_into_play_score")
miss_situations &lt;-
  c("swinging_strike", "swinging_strike_blocked")</code></pre>
<p>I define new variables <code>Count</code>, <code>swing</code>, and <code>miss</code> – the last two variables are indicator functions equal to 1 or 0 if the event (swing or miss) occurs or doesn’t occur.</p>
<pre><code>sc &lt;- sc[, Count := paste(balls, strikes, sep="-")]
sc &lt;- sc[, c("swing", "miss") :=
           .(ifelse(description %in%
                    swing_situations, 1, 0),
             ifelse(description %in%
                      miss_situations, 1, 0))]</code></pre>
</section>
<section id="swinging-by-count" class="level3" data-number="5.11">
<h3 data-number="5.11" class="anchored" data-anchor-id="swinging-by-count"><span class="header-section-number">5.11</span> Swinging by Count</h3>
<p>I compute the number of occurrences <code>N</code> and the fraction of swings <code>M</code>, and group these summaries for each possible count, and then I order the result by the fraction <code>M</code> in descending order. Note the reluctance of the batter to swing in early counts like 0-0 and counts where he has the advantage (like 2-0 or 3-0). It is most likely for the batter to swing in two-strike counts with the exception of a 0-2 count.</p>
<pre><code>sc[, .(.N, M = round(mean(swing), 3)), 
    by = Count][order(- M)]

    Count     N     M
 1:   3-2  4930 0.727
 2:   2-2  8195 0.640
 3:   2-1  5285 0.582
 4:   1-2  9536 0.580
 5:   3-1  2290 0.578
 6:   1-1 10328 0.536
 7:   0-2  6374 0.507
 8:   0-1 12832 0.468
 9:   2-0  3531 0.432
10:   1-0 10095 0.421
11:   0-0 25542 0.289
12:   3-0  1062 0.103</code></pre>
</section>
<section id="making-contact-by-count" class="level3" data-number="5.12">
<h3 data-number="5.12" class="anchored" data-anchor-id="making-contact-by-count"><span class="header-section-number">5.12</span> Making Contact by Count</h3>
<p>Next, assuming that the batter has swung (want to only consider rows where swing == 1), we compute the count and fraction of misses, grouping by count. Here we order in ascending order, so the top rows correspond to the counts where the batter is least likely to miss or most likely to make contact. Generally, it appears that the batter is most likely to make contact when he is ahead in the count. The three most likely counts all have three balls. He is most likely to miss on a 0-2 count.</p>
<pre><code>sc[swing == 1,
    .(.N, M = round(mean(miss), 3)), 
   by = Count][order(M)]

    Count    N     M
 1:   3-0  109 0.083
 2:   3-2 3585 0.155
 3:   3-1 1324 0.162
 4:   2-0 1526 0.172
 5:   2-1 3076 0.203
 6:   2-2 5248 0.216
 7:   1-0 4250 0.227
 8:   1-1 5535 0.230
 9:   0-0 7384 0.232
10:   1-2 5534 0.248
11:   0-1 6002 0.248
12:   0-2 3230 0.253</code></pre>
</section>
<section id="hitting-a-line-drive-by-count" class="level3" data-number="5.13">
<h3 data-number="5.13" class="anchored" data-anchor-id="hitting-a-line-drive-by-count"><span class="header-section-number">5.13</span> Hitting a Line Drive by Count</h3>
<p>Last, assuming that the batter has swung (<code>swing == 1</code>) and has made contact (<code>miss == 0</code>), and we are interested in finding the fraction of line drives, again ordering from most likely to least likely. Here the pattern is not quite as obvious. The most likely line drive counts are 1-0 and 2-2 and the least likely line drive counts are 3-0 and 1-2.</p>
<pre><code>sc[swing == 1 &amp; miss == 0, 
    .(N = .N,
     M = round(mean(bb_type == "line_drive",
                     na.rm = TRUE), 3)),
    by = Count][order(-M)]

    Count    N     M
 1:   1-0 3287 0.267
 2:   2-2 4115 0.266
 3:   1-1 4264 0.258
 4:   2-0 1264 0.257
 5:   3-2 3031 0.251
 6:   0-1 4515 0.250
 7:   2-1 2453 0.249
 8:   0-0 5673 0.248
 9:   3-1 1110 0.241
10:   0-2 2412 0.237
11:   3-0  100 0.236
12:   1-2 4160 0.235</code></pre>
</section>
<section id="why-do-i-like-data-table" class="level3" data-number="5.14">
<h3 data-number="5.14" class="anchored" data-anchor-id="why-do-i-like-data-table"><span class="header-section-number">5.14</span> Why Do I Like data table?</h3>
<p>Many years ago, I became infatuated with the programming language APL. I appreciated the simplity and power of programming using vectors and matrices and APL had special symbols for performing these operations. One could do a relatively complex calculation using one or two lines of APL code. With all of the special symbols, it could be hard to read APL code, but I was impressed with the efficient use of code.</p>
<p>In a similar way, I think <code>data.table</code> provides a very impressive succient syntax for implementing the common data science operations on a table. Once you know the basic bracketing operations in a data frame, then it is a small step to learn the enhanced operations in the data.table package. If one is thinking about the size of the vocabulary one needs to learn, there is no contest between the data.table and dplyr packages – data.table is a clear winner. (By the way, I am disappointed that RStudio, one of the main commercial R companies, appears to ignore the data.table package in their documentation. I would think they should introduce the most useful R packages on their site.)</p>
<p>I encourage you to try data.table out. Here is a blog post that provides a more detailed introduction to the data.table package. It is easy to install the package from CRAN and I have posted all of the R work in this post as a Markdown file on my Github Gist site. I have explored here how the rate of swinging, contact, and line drives depends on the count. The interested reader could instead look at how the average launch speed or average launch angle depends on the situation. At the very least, I provide some easy access to some Statcast data that is fun to play with.</p>
</section>
</section>
<section id="part-5---comparing-two-pitchers-using-ggplot2" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="part-5---comparing-two-pitchers-using-ggplot2"><span class="header-section-number">6</span> Part 5 - Comparing Two Pitchers Using ggplot2</h2>
<section id="introduction-4" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="introduction-4"><span class="header-section-number">6.1</span> Introduction</h3>
<p>This is the last part of our Welcome to R series. Part 4 of this series focused on the use of the data.table package for selecting rows and columns of data frames. Part 3 illustrated the use of some base R graphics functions like <code>hist()</code>, <code>plot()</code>, etc. Here will introduce the <code>ggplot2</code> package which is a system for developing high-quality graphics. It is especially nice when you want make comparisons. I’ll introduce <code>ggplot2</code> within a baseball context, specifically comparing the pitches of two starting pitchers in the 2017 season.</p>
</section>
<section id="comparing-two-2017-phillies-starters" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="comparing-two-2017-phillies-starters"><span class="header-section-number">6.2</span> Comparing Two 2017 Phillies Starters</h3>
<p>If you look over the 2017 Phillies pitching statistics on Baseball-Reference, you will notice two 24-year old pitchers Aaron Nola and Nick Pivetta who had very different pitching performances this particular season. Nola had a 12-11 record with a 3.54 ERA, and Pivetta was 8-10 with a 6.02 ERA. Let’s use Statcast data to look more carefully at the two pitcher stats at the pitch level, perhaps gaining some insight why Nola was so much better than Pivetta during the 2017 season.</p>
<p>We are going to use the same Statcast data that we used in Part 4 of this series. Using the <code>fread()</code> function from the <code>data.table</code> package, I read the data from my Github site and save it in the data table (also data frame) <code>sc</code>.</p>
<pre><code>library(ggplot2)
library(data.table)
sc &lt;- fread("https://raw.githubusercontent.com/bayesball/ABWRdata/master/data/statcast2017.txt")</code></pre>
<p>The Statcast ids for these two pitchers are 601713 and 605400. (I found these numbers by googling the player names together with statcast.) Using <code>data.table</code> syntax, I create a new data.table called two_pitchers containing all of the pitches for these two pitchers. It is convenient to create a new variable <code>Pitcher</code> containing the pitcher names. Also I collect the following variables:</p>
<ul>
<li><p><code>pitch_type</code> – code for the type of pitch</p></li>
<li><p><code>plate_x, plate_z</code> – location of the pitch as it crosses the zone</p></li>
<li><p><code>type</code> – indicates if the pitch is a ball, a strike, or in-play</p></li>
<li><p><code>woba_value</code> – for balls put in play, this gives the woba weight for that event (0 for out, 0.9 for a single, 1.25 for a double, and so on)</p></li>
<li><p><code>release_speed</code> – speed of the pitch (in mph) when released</p></li>
<li><p><code>pfx_x, pfx_z</code> – the horizontal and vertical movement (in inches) of the pitch</p></li>
</ul>
<pre><code>two_pitchers &lt;- sc[pitcher %in% c(601713, 605400)]
two_pitchers &lt;- two_pitchers[, 
            Pitcher := ifelse(pitcher == 601713,
                     "Nick Pivetta", "Aaron Nola") ]
two_pitchers &lt;- two_pitchers[, 
            .(Pitcher, pitch_type, plate_x, 
              plate_z, type, woba_value, 
              release_speed, pfx_x, pfx_z)]</code></pre>
<p>Let’s illustrate using <code>ggplot2</code> to graph from a small dataset. To understand what pitches the two pitchers throw, I construct a frequency table of <code>pitch_type</code> for each pitcher.</p>
<pre><code>(S &lt;- two_pitchers[, .N,  by = .(Pitcher, pitch_type)])
        Pitcher pitch_type   N
1: Nick Pivetta         FF 209
2: Nick Pivetta         SL  37
3:   Aaron Nola         CU 110
4:   Aaron Nola         FF 126
5:   Aaron Nola         CH  59
6:   Aaron Nola         FT  91
7: Nick Pivetta         FT  43
8: Nick Pivetta         CU  79
9: Nick Pivetta         CH  15</code></pre>
</section>
<section id="starting-with-ggplot2" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="starting-with-ggplot2"><span class="header-section-number">6.3</span> Starting with ggplot2</h3>
<p>To use <code>ggplot2</code>, you need to start with a data frame like <code>S</code>. Next, you have to assign aesthetics or roles to particular variables that you wish to graph. Suppose we want to construct a bar graph of these counts for each pitcher. The x variable (the one assigned to the horizontal axis) will be <code>Pitcher</code> and the y variable (the one assigned to the vertical axis) will be <code>N</code>. I want separate bars for each type of pitch, so I will let the <code>fill</code> variable (that is, the color that fills the bar) be <code>pitch_type</code>. The first step of a <code>ggplot2</code> graph is to type</p>
<pre><code>ggplot(df, aes(roles))</code></pre>
<p>where <code>df</code> is a data frame containing the data, and <code>aes()</code> contains all of the aesthetics or roles assigned to the different variables.</p>
<p>Last, we add a geometric object or geom that actually plots the bar or point or something else. Here we use the <code>geom_bar()</code> function that plots a bar – there are two arguments to this particular function – stat = “identity” indicates that the height of the bar should be the count (<code>N</code>) in the data frame and position = “dodge” says that the different pitch types should be plotted with bars that don’t overlap.</p>
<p>Okay, here is the syntax and corresponding graph.</p>
<pre><code>ggplot(S, aes(x = Pitcher, y = N, 
              fill = pitch_type)) +
   geom_bar(stat = "identity", position = "dodge")</code></pre>
<p><img src="figures/welcome/welcome19.png" class="img-fluid" style="width:70.0%"></p>
<p>What is interesting is that Nola uses four pitches (changeup, curve ball, four-seamer and two-seamer) with similar frequencies. In contrast, Pivetta is primarily a four-seam pitcher with some curve balls, two-seamers, changeups and sliders.</p>
<p>I can choose to use different geometric objects. For example, I can choose to plot points instead of bars using the geom_point() function. I prefer bars in this particular case, but it might be good to plot points sometimes.</p>
<pre><code>ggplot(S, aes(x = Pitcher, y = N, 
              color = pitch_type)) +
   geom_point()</code></pre>
<p><img src="figures/welcome/welcome20.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="comparing-groups-1" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="comparing-groups-1"><span class="header-section-number">6.4</span> Comparing groups</h3>
<p>Suppose we wish to compare the release speeds of pitches of Nola and Pivetta. Now, since different pitch types have different speeds, it makes sense to compare within pitch type – for example, compare the speeds of four-seamers, compare the speeds of curve balls, etc. In the following <code>ggplot2</code> code …</p>
<ul>
<li><p>I want to exclude sliders since only Pivetta throws a slider.</p></li>
<li><p>I want to plot the <code>release_speed</code> as the y-variable and the <code>Pitcher</code> on the x-variable.</p></li>
<li><p>I plot points that are jittered to minimize overlapping.</p></li>
<li><p>I want to construct different plots for each pitch type – these different subplots are called facets – and I create these individual plots by use of the <code>facet_wrap()</code> function.</p></li>
</ul>
<pre><code>ggplot(two_pitchers[ pitch_type != "SL"],
       aes(Pitcher, release_speed)) +
   geom_jitter() +
   facet_wrap(~ pitch_type)</code></pre>
<p><img src="figures/welcome/welcome21.png" class="img-fluid" style="width:70.0%"></p>
<p>This graph is interesting with some takeaways. Pivetta throws his four-seamer (FF) faster than Nola on average. Nola has a slower curve ball than Pivetta. Also the speeds of Nola’s curve balls have smaller variation than those of Pivetta – this tells me that Nola has more control over his curve ball.</p>
<p>We decided to plot points by use of the <code>geom_jitter()</code> function. We can instead use the <code>geom_violin()</code> function to construct violin plots for the groups of speed values. Basically, the violin plot is a density plot and its mirror image. The reader might prefer these graphs but I admit they might look funny at first.</p>
<pre><code>ggplot(two_pitchers[ pitch_type != "SL"],
       aes(Pitcher, release_speed)) +
   geom_violin() +
   facet_wrap(~ pitch_type)</code></pre>
<p><img src="figures/welcome/welcome22.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="scatterplots" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="scatterplots"><span class="header-section-number">6.5</span> Scatterplots</h3>
<p>Different pitches vary not only by release speed but in terms of horizontal and vertical movement which are measured by the <code>pfx_x</code> and <code>pfx_z</code> variables. In the below graph, the x variable is <code>pfx_x</code>, the y variable is <code>pfx_z</code> and I am using different facets for different pitch types. Also I represent the color of the point by the <code>Pitcher</code> variable – note that I use <code>color = Pitcher</code> which is another aesthetic that is passed along in the <code>aes()</code> function.</p>
<pre><code>ggplot(two_pitchers[ pitch_type != "SL"],
       aes(pfx_x, pfx_z, color = Pitcher)) +
   geom_point() +
   facet_wrap(~ pitch_type)</code></pre>
<p><img src="figures/welcome/welcome23.png" class="img-fluid" style="width:70.0%"></p>
<p>The size of the movement is different between the two pitchers. For example, look at the CU (curve ball) graph – Nola’s curve balls have a much larger horizontal movement than Pivetta’s curve ball. Pivetta’s four-seamers (look at the FF graph) tend to have more vertical movement than Nola’s.</p>
<p>We can also use a scatterplot with assigned x and y variables to show pitch locations. Below I graph the pitch location (x variable is <code>plate_x</code>, y variable is <code>plate_z</code>) where the color of the point is <code>Pitcher</code>. Note that I’ve added the plate zone to the graph. I have a function <code>add_zone()</code> that adds a <code>ggplot2</code> layer (the black square) to the graph. (One nice feature of ggplot2 is it’s layered approach to graphing.)</p>
<pre><code>library(CalledStrike)
ggplot(two_pitchers[ pitch_type != "SL"],
       aes(plate_x, plate_z)) +
   geom_point(aes(color = Pitcher)) +
   facet_wrap(~ pitch_type) + 
   add_zone('black')</code></pre>
<p><img src="figures/welcome/welcome24.png" class="img-fluid" style="width:70.0%"></p>
<p>It may be hard to distinguish the red and green points above, so I’ll try another graph to compare the pitch locations. Let’s focus on four-seamers (FF) and curve balls (CU) and I use different facets for each combination of pitch_type and Pitcher.</p>
<pre><code>ggplot(two_pitchers[ pitch_type %in% c("FF", "CU")],
       aes(plate_x, plate_z)) +
   geom_point() +
   facet_grid(pitch_type ~ Pitcher) + 
   add_zone('red')</code></pre>
<p><img src="figures/welcome/welcome25.png" class="img-fluid" style="width:70.0%"></p>
<p>Remember my comment about the consistency in movement of Nola’s curve balls? Nola seems to have better location on his curve balls. Nola’s curve balls tend to be low in the zone, while Pivetta’s curve balls tend to be all over the place.</p>
</section>
<section id="balls-put-in-play" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="balls-put-in-play"><span class="header-section-number">6.6</span> Balls put in play</h3>
<p>Next let’s focus on pitches put into play which is indicated by <code>type = "X"</code> in our Statcast dataset. We’ll focus on four-seam fastballs and curveballs. For each pitcher and each pitch type, I plot the locations of the pitches where the color of the plotted point corresponds to the woba value of the pitch. In the code below, note that I set the aesthetic color to the character version of the woba_value. There are five possible values of <code>woba_value</code> of 0, 0.9, 1.25, 1.6, 2 corresponding respectively to out, single, double, triple and home run, and each value has a distinct color. For example, note that the two curve balls thrown by Pivetta in the middle of the plate were hit for home runs. This would suggest that the middle of the plate is not a desirable location for Pivetta’s curve ball.</p>
<pre><code>ggplot(two_pitchers[ pitch_type %in% 
            c("FF", "CU") &amp; type == "X"],
       aes(plate_x, plate_z)) +
   geom_point(aes(color = 
                     as.character(woba_value))) +
   facet_grid(pitch_type ~ Pitcher) + 
   add_zone('black')</code></pre>
<p><img src="figures/welcome/welcome26.png" class="img-fluid" style="width:70.0%"></p>
</section>
<section id="takeaways" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="takeaways"><span class="header-section-number">6.7</span> Takeaways</h3>
<p>The purpose of this Welcome to R segment was to introduce <code>ggplot2</code> and provide how it can be used to produce interesting plots. I especially like its ability to easily produce facets since this is a good method for making graphical comparisons. Also the default parameters of <code>ggplot2</code> are attractive and they don’t require much extra modification.</p>
<p>Our comparison of Nola and Pivetta was interesting. Comparing the two pitchers, Nola displays a wider selection of pitch types than Pivetta. Also, comparing curve balls, Nola appears to have a high breaking pitch and he seems very consistent in his delivery, both in speed and location.</p>
<p>If you want to learn more about <code>ggplot2</code>, a good reference is the Data Visualization chapter of R for Data Science .</p>
<p>All of this code is available as a Markdown document. To get familiar with <code>ggplot2</code>, try the examples and graphically compare two other pitchers for the 2017 season that you care about.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>